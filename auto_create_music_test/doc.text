Yahoo!とのミーティングに向けて、音楽を自動生成する機能を開発する。
Pythonのライブコーディングツール『FoxDot』を用いて、音楽を自動的に生成させる。

## まずはコードからFoxDotを動かす方法を調べる。
FoxDotを起動させたときに表示されるタブに`Tutorials`というタブがある。
ここを選択すると、書き込まれているファイルが読み込まれる。

このファイルを全選択して、実行してやれば、自動実行はできる。
ただ、あまりに違う中身を実行してしまうと途切れてしまうので、少し工夫が必要。

### 実験_1
FoxDotの中にあるtutorialsフォルダにファイルを追加すれば、そのファイルが読み込まれるのかをチェックする。

Tutorialsタブに追加された。ただ、FoxDotを再起動しないとタブに表示されなかったので、どうするか。

### 実験_2
Tutorialsタブに追加されたファイルが更新された場合、tutorialタブから再読み込みしたときに
その更新が反映されているか。

FoxDotを再起動しなくても、ファイルが再実行された。
なので、音楽の自動生成時にファイルを再読み込みさせればいい。

**思考中**
FoxDotの前提ルール
変数は2文字の組み合わせを用いて作成し、その数には限りがない(CPUリソース)


ここで取れる選択肢
- 生成したタイミングで、GUIを操作してtutorialタブから再読み込み、さらに全選択して音声を実行
- ファイルを読みだしている部分を解読して、各変数ごとにずらして譜面を自動生成

拡張性は下の方がある。

各楽器ごとに、いい感じの音楽コードを保存しておき、そこから30秒おきにランダムで取得して、
その行のコードを書き換えてやり、GUI操作して、tutorialタブを選択して、更新されているファイルを選択、
さらにそこから全体を選択して再実行。

### 調査_1
GUI操作する方法
1. PyAutoGUI
http://whitecat-student.hatenablog.com/entry/2016/06/27/010812
https://qiita.com/hirohiro77/items/78e26a59c2e45a0fe4e3
https://www.lisz-works.com/entry/pyautogui-mouse

2.AutoPy
http://whitecat-student.hatenablog.com/entry/2016/10/24/125000

とりあえず、PyautoGUIを使って処理を自動化してみる。

### 導入_1
pyAutpGUIを導入する。

インタプリンタで動作を試す。
```
import pyautogui
import sys
import time

# 画面サイズの取得
screen_x,screen_y = pyautogui.size()
print (u"printについてる[u]はunicodeにするのuでマルチバイト表記が化けるときにつけるよ")
print (u"画面サイズ [" + str(screen_x) + "]/[" + str(screen_y) + "]")

# 画面中央にカーソルを動かす
center_x = screen_x / 2
center_y = screen_y / 2
print (u"画面中央 [" + str(center_x) + "]/[" + str(center_y) + "]")
pyautogui.moveTo(center_x, center_y, duration=2)
```
### スクリプトファイルから実行
```
##PyAutoGUIのモジュール
import pyautogui

##プロセスを制御するためにOS周りのモジュール
import sys
import time


# 画面サイズの取得
screen_x, screen_y = pyautogui.size()


if __name__ == "__main__":
    time.sleep(5)

    # 現在のマウス位置の取得
    tmp_cur_x, tmp_cur_y = pyautogui.position()  # 現在のマウスのxとy座標を返す
    print(tmp_cur_x, tmp_cur_y)


    # もし画面内カーソルにあればTrueを返す
    cursor_flag = pyautogui.onScreen(tmp_cur_x, tmp_cur_y)
    print(cursor_flag)

    # 現在のマウスカーソルの座標から(xOffset,yOffset)だけtime秒で移動する．
    pyautogui.moveRel(2, 2, 2)

    # 現在のマウス位置の取得
    tmp_cur_x, tmp_cur_y = pyautogui.position()  # 現在のマウスのxとy座標を返す
    print(tmp_cur_x, tmp_cur_y)

    # その場所でマウスを左クリックする
    pyautogui.click(tmp_cur_x, tmp_cur_y)
```

これが動作することは確認できた。

ここから目的とする動作のワークフローを考える。
1. 最初にFoxDotとsupercoliderを起動しておく(手動)
2. FoxDotを特定の場所におく(手動)
3. カーソルをtutorialタブに置く(手動)
4. 音楽更新スクリプトでpythonファイルを更新
5. Tutorialsタブをクリックして、開く
6. マウスを動かし、16番目のファイルをクリック
7. FoxDotのエディタを全選択
8. ctrl+Enterで実行
9. Tutorialsタブの位置まで戻す
9. 30秒待機
10. 無限ループ

### 実装_1
まずは3まで用意する。

FoxDotは全画面表示にしておく。
とりあえず、50px下に動かしてみる。
全然足りない。

300pxにする。
11番目だった。

450とか。
420でベストフィット。

コマンドラインから音楽を自動生成することができた。
音楽更新スクリプトを作成する。

## 音楽を自動で生成させる。
自動生成スクリプトの概要。

ベースのリズムは奇数たち。
使う楽器の種類である変数はこちら側で設定する。
それごとにコードを用意してやり、その中からランダムでコードを選択する。
json形式で、データを保存しておく。

**思考中**
まずは今のファイル状態を読み込んでおく。
楽器ごとにどの行にファイルを置くかを設定しておく。

ファイルの中で変数群の中から何個更新するかを決定させる。
その数だけ変数の中からランダムでどれを更新するかを選ぶ。
それを配列にする。
それをforeachで処理する。

テキストを読み込んで、該当の行を更新するのはセンスない。
なので、あらかじめどの楽器がどの行にあるかを設定しておき、
変数が選択された時点でどの行を更新するかを決定させたい。

そんなことしなくても！！！
全音源のリストを作成する。
それを元にforeachを回してやる。
ここで更新判定を行う。rand関数を使い、値が閾値以上なら更新。
同時に現在のループ回数を保存しておく。
この値を使って、どの行を更新するのかを判断する。

更新する場合は、設定ファイルから読みだした各音源の生成コードからどのコード
を使用するかを判断する。
ここは該当辞書の要素数を読み取って、その範囲で整数乱数を振る。
そのコードを取得して、該当楽器の変数と組み合わせて、実際のコードを生成する。

そのコードをループ回数のファイル行に更新する。
それを呼び出してやれば、該当ファイルが更新される。

### 実装_1
まずは、適当な音源コードをjson形式で用意して、ファイルが呼び出せるかをチェックする。

FoxDotのtutorialsフォルダがある場所
C:\Users\admin\AppData\Local\Programs\Python\Python36\Lib\site-packages\FoxDot\demo

pythonでpythonファイルを読み出す方法
普通にopenメソッドで書き込めばＯＫ。

次は指定行にファイルを書き込む方法を調べる。
調べた結果、一行ごとにファイルを書き込む方法はないので、
別の道を模索する。

現行の動いているファイルを一行ごとに読み込んで、
配列に格納する。

これをforeachでループを回す。

ループではとりあえず更新するかどうかを判断する。
ここから更新する変数を取得する。

次に何番目のコードを取得するかを判断する。
ランダム関数で整数値を取得する。
その前に該当音源の要素数を取得する。

リストを後でつなげて、テキストにする。

できた！
次は、音源プールを作成する。
まずはドラム系
d1
d2
d3
の三種類を同じプールで作成する。